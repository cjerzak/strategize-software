<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="date" content="2025-12-23" />

<title>Strategize Package Tutorial</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Strategize Package Tutorial</h1>
<h4 class="date">2025-12-23</h4>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>The <code>strategize</code> package implements methods for finding
optimal stochastic interventions in high-dimensional factorial
(including conjoint) experiments. Unlike standard AMCE-based analyses,
which marginalize outcomes over the existing experimental distribution
(often uniform), these methods identify a counterfactual distribution
over factors that best achieves a target (e.g., maximizing a vote-choice
outcome). In adversarial contexts, multiple distributions can be learned
simultaneously (e.g., two political parties each optimizing candidate
features in competition).</p>
<p>This vignette illustrates core functionality:</p>
<ul>
<li><strong>Section 1</strong> constructs a toy dataset (since we do not
assume you have your own data in this example).</li>
<li><strong>Section 2</strong> demonstrates a two-step approach to (1)
fit an outcome model (like a logistic regression) and (2) optimize a
<em>stochastic intervention</em> to maximize that model’s predicted
outcome.</li>
<li><strong>Section 3</strong> highlights features like adversarial
(max-min) scenarios, cross-validation, and multi-cluster
expansions.</li>
<li><strong>Section 4</strong> briefly shows an alternative one-step
M-estimation procedure.</li>
</ul>
<p>Throughout, we will use raw <code>R</code> code chunks to illustrate
typical usage in <code>R</code>, including how to specify factor-level
probability constraints, run the optimization, and interpret the
results.</p>
<div id="installation" class="section level2">
<h2>Installation</h2>
<p>This tutorial assumes you have installed the strategize package,
either from source or via GitHub:</p>
<pre><code># If you haven&#39;t installed or set up the package:
# devtools::install_github(&quot;cjerzak/strategize-software/strategize&quot;)

# (Done once) Optionally build the JAX backend if needed - done once 
# strategize::build_backend(conda_env = &quot;strategize&quot;)</code></pre>
</div>
<div id="constructing-example-data" class="section level2">
<h2>Constructing Example Data</h2>
<p>Most methods in <code>strategize</code> require:</p>
<ul>
<li>A matrix (or data frame) <code>W</code> of factor levels in a
factorial/conjoint design. Each column is a factor; each row is a
profile or a respondent-task-profile observation.</li>
<li>An outcome <code>Y</code>. In forced-choice setups, <code>Y</code>
could be 1 if a given profile is chosen, 0 otherwise.</li>
<li>(Optionally) <code>X</code>, which are respondent covariates or
other features if you want cluster-specific or multi-group
analysis.</li>
<li>A list <code>p_list</code> that captures the original assignment
probabilities for each factor (the randomization distribution).</li>
</ul>
<p>Below, we construct a toy dataset:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># A small example: Suppose we have a forced-choice design with 1000</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co"># respondent-profile observations, each profile has 3 factors.</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co"># Create a simple data frame &#39;my_data_red&#39; that includes:</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#  - respondent/candidate group variables for adversarial scenarios</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#  - factors that will populate FACTOR_MAT_</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#  - an outcome Yobs</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">4000</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>my_data_red <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>  <span class="co"># For adversarial grouping:</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>  <span class="at">R_Partisanship =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;Democrat&quot;</span>, <span class="st">&quot;Republican&quot;</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>  <span class="at">Party.affiliation_clean =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;Democrat&quot;</span>, <span class="st">&quot;Republican&quot;</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>  <span class="at">Party.competition =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;Same&quot;</span>, <span class="st">&quot;Different&quot;</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>  </span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>  <span class="co"># For indexing each respondent and task:</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>  <span class="at">respondentIndex =</span> <span class="fu">c</span>(<span class="fu">replicate</span>(<span class="dv">2</span>,<span class="dv">1</span><span class="sc">:</span>(n<span class="sc">/</span><span class="dv">2</span>))),</span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>  <span class="at">task =</span> <span class="fu">c</span>(<span class="fu">replicate</span>(n,<span class="dv">1</span>)),</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>  <span class="at">profile_order =</span> <span class="fu">c</span>(<span class="fu">replicate</span>((n<span class="sc">/</span><span class="dv">2</span>),<span class="dv">1</span>),<span class="fu">replicate</span>((n<span class="sc">/</span><span class="dv">2</span>),<span class="dv">2</span>)), <span class="co"># for every respondent and task, there is a profile order </span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>  </span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>  <span class="co"># Some factors for the conjoint:</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>  <span class="at">Sex =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>  <span class="at">Age =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;36-51&quot;</span>,<span class="st">&quot;52-67&quot;</span>,<span class="st">&quot;68-76&quot;</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>  <span class="at">Family =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;Single (divorced)&quot;</span>, <span class="st">&quot;Single (never married)&quot;</span>,</span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>                    <span class="st">&quot;Married (no child)&quot;</span>, <span class="st">&quot;Married (two children)&quot;</span>),</span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>                  n, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a>)</span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a><span class="co"># Suppose Yobs is our outcome (e.g., was this profile chosen?)</span></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a>Yobs <span class="ot">&lt;-</span> <span class="fu">c</span>(y_ <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n<span class="sc">/</span><span class="dv">2</span>, <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.5</span>), <span class="dv">1</span> <span class="sc">-</span> y_)  <span class="co"># purely random for illustration</span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a><span class="co"># Construct &#39;FACTOR_MAT_&#39; from the factor columns we want to optimize over:</span></span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a>FACTOR_MAT_ <span class="ot">&lt;-</span> my_data_red[, <span class="fu">c</span>(<span class="st">&quot;Sex&quot;</span>,<span class="st">&quot;Age&quot;</span>,<span class="st">&quot;Family&quot;</span>)]</span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a><span class="co"># (Optional) A cluster variable for variance computations:</span></span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a>cluster_var <span class="ot">&lt;-</span> my_data_red<span class="sc">$</span>respondentIndex   <span class="co"># or something more meaningful</span></span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a></span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a><span class="co"># Pair or choice-set IDs (if forced-choice):</span></span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a>pair_id <span class="ot">&lt;-</span> <span class="fu">paste0</span>(my_data_red<span class="sc">$</span>respondentIndex, <span class="st">&quot;_&quot;</span>, my_data_red<span class="sc">$</span>task)</span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a></span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a><span class="co"># Original assignment probability list (assume uniform or known):</span></span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a>p_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2-42"><a href="#cb2-42" tabindex="-1"></a>  <span class="at">Sex =</span> <span class="fu">c</span>(<span class="st">&quot;Female&quot;</span> <span class="ot">=</span> <span class="fl">0.5</span>, <span class="st">&quot;Male&quot;</span> <span class="ot">=</span> <span class="fl">0.5</span>),</span>
<span id="cb2-43"><a href="#cb2-43" tabindex="-1"></a>  <span class="at">Age =</span> <span class="fu">c</span>(<span class="st">&quot;36-51&quot;</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="st">&quot;52-67&quot;</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="st">&quot;68-76&quot;</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>),</span>
<span id="cb2-44"><a href="#cb2-44" tabindex="-1"></a>  <span class="at">Family =</span> <span class="fu">c</span>(<span class="st">&quot;Single (divorced)&quot;</span> <span class="ot">=</span> <span class="fl">0.25</span>,</span>
<span id="cb2-45"><a href="#cb2-45" tabindex="-1"></a>             <span class="st">&quot;Single (never married)&quot;</span> <span class="ot">=</span> <span class="fl">0.25</span>,</span>
<span id="cb2-46"><a href="#cb2-46" tabindex="-1"></a>             <span class="st">&quot;Married (no child)&quot;</span> <span class="ot">=</span> <span class="fl">0.25</span>,</span>
<span id="cb2-47"><a href="#cb2-47" tabindex="-1"></a>             <span class="st">&quot;Married (two children)&quot;</span> <span class="ot">=</span> <span class="fl">0.25</span>)</span>
<span id="cb2-48"><a href="#cb2-48" tabindex="-1"></a>)</span>
<span id="cb2-49"><a href="#cb2-49" tabindex="-1"></a></span>
<span id="cb2-50"><a href="#cb2-50" tabindex="-1"></a><span class="co"># If you want &#39;slates&#39; of candidate features by party (for multi-stage or adversarial):</span></span>
<span id="cb2-51"><a href="#cb2-51" tabindex="-1"></a>SlateList <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2-52"><a href="#cb2-52" tabindex="-1"></a>  <span class="st">&quot;Democratic&quot;</span> <span class="ot">=</span> p_list,</span>
<span id="cb2-53"><a href="#cb2-53" tabindex="-1"></a>  <span class="st">&quot;Republican&quot;</span> <span class="ot">=</span> p_list</span>
<span id="cb2-54"><a href="#cb2-54" tabindex="-1"></a>)</span>
<span id="cb2-55"><a href="#cb2-55" tabindex="-1"></a></span>
<span id="cb2-56"><a href="#cb2-56" tabindex="-1"></a><span class="co"># Illustrative hyperparameter settings </span></span>
<span id="cb2-57"><a href="#cb2-57" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rbind</span>(X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(n<span class="sc">/</span><span class="dv">2</span> <span class="sc">*</span> <span class="dv">2</span>), n<span class="sc">/</span><span class="dv">2</span>, <span class="dv">2</span>), X)  <span class="co"># optional respondent covariates</span></span>
<span id="cb2-58"><a href="#cb2-58" tabindex="-1"></a>nSGD_TwoStep <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb2-59"><a href="#cb2-59" tabindex="-1"></a>nMonte_adversarial <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb2-60"><a href="#cb2-60" tabindex="-1"></a>regularizationType <span class="ot">&lt;-</span> <span class="st">&quot;KL&quot;</span>    <span class="co"># penalty type (&quot;KL&quot;,&quot;L2&quot;,&quot;LogMaxProb&quot;, etc.)</span></span>
<span id="cb2-61"><a href="#cb2-61" tabindex="-1"></a>conda_env <span class="ot">&lt;-</span> <span class="st">&quot;strategize&quot;</span></span>
<span id="cb2-62"><a href="#cb2-62" tabindex="-1"></a>GLOBAL_NFOLDS <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb2-63"><a href="#cb2-63" tabindex="-1"></a>nFolds_glm <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb2-64"><a href="#cb2-64" tabindex="-1"></a>lambda_MaxMin <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb2-65"><a href="#cb2-65" tabindex="-1"></a>LAMBDA_SEQ <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.01</span>, lambda_MaxMin)</span></code></pre></div>
<p>This toy dataset has 3 factors, each with 3 levels, and
<code>Y</code> is a binary outcome that depends on factor levels as
above. The distribution is uniform, so <code>p_list</code> has 1/3 for
each factor-level. Next, we show how to run a two-step approach that (1)
fits an outcome model and (2) searches for the factor-level distribution
that maximizes the fitted outcome predictions.</p>
</div>
</div>
<div id="basic-two-step-usage-for-average-case-optimization" class="section level1">
<h1>Basic Two-Step Usage for Average-Case Optimization</h1>
<div id="using-strategize" class="section level2">
<h2>Using <code>strategize</code></h2>
<p>We now pass this fitted model to <code>strategize</code>, which will
search for the factor-level distribution that maximizes the average
predicted outcome. Because we are in a simpler context, we might specify
<code>MaxMin=FALSE</code> to do the scenario. We’ll set
<code>lambda</code> for a mild <span class="math inline">\(L_2\)</span>
regularization penalty so that our new distribution does not stray too
far from <code>p_list</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">library</span>(strategize)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>AdversarialValue <span class="ot">&lt;-</span> <span class="cn">FALSE</span> </span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#if AdversarialValue = FALSE, use &#39;cv_strategize&#39; for standard cross-validation and single-agent optimization.</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>res_avecase <span class="ot">&lt;-</span> {<span class="fu">cv_strategize</span>(</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>  <span class="co"># Core inputs:</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  <span class="at">Y =</span> Yobs,</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>  <span class="at">W =</span> FACTOR_MAT_,</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>  <span class="at">X =</span> <span class="cn">NULL</span>,</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>  </span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>  <span class="co"># Regularization or penalty inputs:</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>  <span class="at">lambda =</span> LAMBDA_SEQ,</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>  <span class="at">penalty_type =</span> regularizationType,</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>  <span class="at">use_regularization =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>  </span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>  <span class="co"># Clustering / grouping:</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>  <span class="at">varcov_cluster_variable =</span> cluster_var, <span class="co"># in applications, this could be respondent</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>  <span class="at">competing_group_variable_respondent =</span> <span class="cn">NULL</span>,</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>  <span class="at">competing_group_variable_candidate =</span> <span class="cn">NULL</span>,</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>  <span class="at">competing_group_competition_variable_candidate =</span> <span class="cn">NULL</span>,</span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>  </span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>  <span class="co"># IDs and factor specification:</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>  <span class="at">pair_id =</span> pair_id,</span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>  <span class="at">respondent_id =</span> my_data_red<span class="sc">$</span>respondentIndex,</span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>  <span class="at">respondent_task_id =</span> my_data_red<span class="sc">$</span>task,</span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>  <span class="at">profile_order =</span> my_data_red<span class="sc">$</span>profile_order,</span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>  </span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a>  <span class="co"># Probability lists:</span></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a>  <span class="at">p_list =</span> p_list,</span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a>  <span class="at">slate_list =</span> SlateList,</span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a>  </span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a>  <span class="co"># Optimization controls:</span></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a>  <span class="at">K =</span> <span class="dv">1</span><span class="dt">L</span>,</span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a>  <span class="at">force_gaussian =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a>  <span class="at">nSGD =</span> nSGD_TwoStep,</span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a>  <span class="at">nMonte_adversarial =</span> nMonte_adversarial,</span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a>  <span class="at">compute_se =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a>  </span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a>  <span class="co"># If we only want a &#39;difference&#39; structure on the first iteration, for example:</span></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a>  <span class="at">diff =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a>  </span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a>  <span class="co"># Cross-validation folds (only used if calling cv_strategize):</span></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a>  <span class="at">folds =</span> GLOBAL_NFOLDS,</span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a>  <span class="at">nFolds_glm =</span> nFolds_glm,</span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a>  </span>
<span id="cb3-47"><a href="#cb3-47" tabindex="-1"></a>  <span class="co"># Toggling between single-agent vs. adversarial:</span></span>
<span id="cb3-48"><a href="#cb3-48" tabindex="-1"></a>  <span class="at">adversarial =</span> AdversarialValue,</span>
<span id="cb3-49"><a href="#cb3-49" tabindex="-1"></a>  </span>
<span id="cb3-50"><a href="#cb3-50" tabindex="-1"></a>  <span class="co"># Python environment management:</span></span>
<span id="cb3-51"><a href="#cb3-51" tabindex="-1"></a>  <span class="at">conda_env =</span> conda_env,</span>
<span id="cb3-52"><a href="#cb3-52" tabindex="-1"></a>  <span class="at">conda_env_required =</span> <span class="cn">TRUE</span></span>
<span id="cb3-53"><a href="#cb3-53" tabindex="-1"></a>)}</span>
<span id="cb3-54"><a href="#cb3-54" tabindex="-1"></a></span>
<span id="cb3-55"><a href="#cb3-55" tabindex="-1"></a><span class="co"># Inspect results:</span></span>
<span id="cb3-56"><a href="#cb3-56" tabindex="-1"></a>res_avecase<span class="sc">$</span>pi_star_point     <span class="co"># The learned factor-level distribution(s)</span></span>
<span id="cb3-57"><a href="#cb3-57" tabindex="-1"></a>res_avecase<span class="sc">$</span>Q_point_mEst     <span class="co"># The estimated performance or outcome</span></span>
<span id="cb3-58"><a href="#cb3-58" tabindex="-1"></a></span>
<span id="cb3-59"><a href="#cb3-59" tabindex="-1"></a>res_avecase<span class="sc">$</span>PiStar_se        <span class="co"># Standard errors (if compute_se=TRUE)</span></span>
<span id="cb3-60"><a href="#cb3-60" tabindex="-1"></a>res_avecase<span class="sc">$</span>Q_se_mEst        <span class="co"># Standard errors </span></span></code></pre></div>
<p>In this snippet, <code>strategize</code> searches for the
factor-level distribution maximizing predicted <code>Y</code>, subject
to an <span class="math inline">\(L_2\)</span> penalty that prevents
that distribution from deviating too drastically from
<code>p_list</code>. The output includes:</p>
<ul>
<li><code>$PiStar_point</code>: a list of length <span class="math inline">\(D\)</span> (the number of factors), each
containing the new factor-level probabilities.</li>
<li><code>$Q_point_mEst</code>: the estimated average outcome (vote
share) at that new distribution.</li>
<li><code>$PiStar_se</code>: approximate standard errors for the factor
probabilities (Delta method).</li>
<li><code>$Q_se_mEst</code>: approximate standard error for the average
outcome.</li>
</ul>
<p><strong>Interpretation.</strong> The factor-level probabilities in
<code>PiStar_point</code> show how <code>strategize</code> suggests
<em>reallocating</em> factor levels, relative to the original
<code>p_list</code>, to improve the outcome. For instance, if
<code>Position=&quot;Center&quot;</code> gets upweighted, that means the model
suggests that a more centrist stance is beneficial. Because of the <span class="math inline">\(L_2\)</span> penalty, we do not push any
factor-level probability to <span class="math inline">\(0\)</span> or
<span class="math inline">\(1\)</span> but move them in ways that
modestly improve predicted <code>Y</code>.</p>
<div id="plotting-the-estimated-factor-level-probabilities" class="section level3">
<h3>Plotting the Estimated Factor-Level Probabilities</h3>
<p>We can compare <code>p_list</code>
vs. <code>res_avg$PiStar_point</code> to see how the method reweights
each factor. A simple barplot can suffice:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>oldpar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="cf">for</span>(d <span class="cf">in</span> <span class="fu">seq_along</span>(p_list)){</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  old_probs <span class="ot">&lt;-</span> p_list[[d]]</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  new_probs <span class="ot">&lt;-</span> res_avecase<span class="sc">$</span>PiStar_point[[<span class="dv">1</span>]][[d]]  <span class="co"># if single cluster</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  <span class="fu">barplot</span>( <span class="fu">rbind</span>(old_probs, new_probs), <span class="at">beside=</span><span class="cn">TRUE</span>,</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>           <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;gray&quot;</span>,<span class="st">&quot;blue&quot;</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>           <span class="at">main=</span><span class="fu">names</span>(p_list)[d], <span class="at">ylab=</span><span class="st">&quot;Prob.&quot;</span>)</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;Original&quot;</span>, <span class="st">&quot;Optimal&quot;</span>), <span class="at">fill=</span><span class="fu">c</span>(<span class="st">&quot;gray&quot;</span>,<span class="st">&quot;blue&quot;</span>), <span class="at">cex=</span><span class="fl">0.8</span>)</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>}</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="fu">par</span>(oldpar)</span></code></pre></div>
<p>In a real analysis, you would interpret which factor levels are
up-weighted vs. down-weighted, linking them to your experimental factors
(e.g., <code>Party=&quot;Rep&quot;</code> might be heavily favored if that yields
higher predicted support).</p>
</div>
</div>
</div>
<div id="adversarial-max-min-setup" class="section level1">
<h1>Adversarial (Max-Min) Setup</h1>
<p><code>strategize</code> also supports an adversarial scenario in
which two (or more) distributions are simultaneously optimized. This is
relevant in two-party electoral contexts or any zero-sum environment. In
this case, each side tries to maximize or minimize the other’s
outcome.</p>
<div id="max-min-example" class="section level2">
<h2>Max-Min Example</h2>
<p>Suppose we want to model a scenario where <code>Party=&quot;A&quot;</code>
tries to maximize the outcome, while <code>Party=&quot;B&quot;</code> tries to
minimize it. We can approximate the equilibrium by specifying
<code>adversarial=TRUE</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>AdversarialValue <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co"># if AdversarialValue = TRUE, use &#39;strategize&#39; for a max-min problem;</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>res_adversarial <span class="ot">&lt;-</span> {<span class="fu">strategize</span>(</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="co"># Core inputs:</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  <span class="at">Y =</span> Yobs,</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  <span class="at">W =</span> FACTOR_MAT_,</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>  <span class="at">X =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  </span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>  <span class="co"># Regularization or penalty inputs:</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>  <span class="at">lambda =</span> lambda_MaxMin,</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>  <span class="at">penalty_type =</span> regularizationType,</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>  <span class="at">use_regularization =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>  </span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>  <span class="co"># Clustering / grouping:</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>  <span class="at">varcov_cluster_variable =</span> cluster_var,</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>  <span class="at">competing_group_variable_respondent =</span> my_data_red<span class="sc">$</span>R_Partisanship,</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>  <span class="at">competing_group_variable_candidate =</span> my_data_red<span class="sc">$</span>Party.affiliation_clean,</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>  <span class="at">competing_group_competition_variable_candidate =</span> my_data_red<span class="sc">$</span>Party.competition,</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>  </span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>  <span class="co"># IDs and factor specification:</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>  <span class="at">pair_id =</span> pair_id,</span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>  <span class="at">respondent_id =</span> my_data_red<span class="sc">$</span>respondentIndex,</span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>  <span class="at">respondent_task_id =</span> my_data_red<span class="sc">$</span>task,</span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>  <span class="at">profile_order =</span> my_data_red<span class="sc">$</span>profile,</span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a>  </span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a>  <span class="co"># Probability lists:</span></span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>  <span class="at">p_list =</span> p_list,</span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a>  <span class="at">slate_list =</span> SlateList,</span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a>  </span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a>  <span class="co"># Optimization controls:</span></span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a>  <span class="at">K =</span> <span class="dv">1</span><span class="dt">L</span>,</span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a>  <span class="at">force_gaussian =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a>  <span class="at">nSGD =</span> nSGD_TwoStep,</span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a>  <span class="at">nMonte_adversarial =</span> nMonte_adversarial,</span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a>  <span class="at">compute_se =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-37"><a href="#cb5-37" tabindex="-1"></a>  </span>
<span id="cb5-38"><a href="#cb5-38" tabindex="-1"></a>  <span class="co"># If we only want a &#39;difference&#39; structure on the first iteration, for example:</span></span>
<span id="cb5-39"><a href="#cb5-39" tabindex="-1"></a>  <span class="at">diff =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-40"><a href="#cb5-40" tabindex="-1"></a>  </span>
<span id="cb5-41"><a href="#cb5-41" tabindex="-1"></a>  <span class="co"># Cross-validation folds (only used if calling cv_strategize):</span></span>
<span id="cb5-42"><a href="#cb5-42" tabindex="-1"></a>  <span class="at">folds =</span> GLOBAL_NFOLDS,</span>
<span id="cb5-43"><a href="#cb5-43" tabindex="-1"></a>  <span class="at">nFolds_glm =</span> nFolds_glm,</span>
<span id="cb5-44"><a href="#cb5-44" tabindex="-1"></a>  </span>
<span id="cb5-45"><a href="#cb5-45" tabindex="-1"></a>  <span class="co"># Toggling between single-agent vs. adversarial:</span></span>
<span id="cb5-46"><a href="#cb5-46" tabindex="-1"></a>  <span class="at">adversarial =</span> AdversarialValue,</span>
<span id="cb5-47"><a href="#cb5-47" tabindex="-1"></a>  </span>
<span id="cb5-48"><a href="#cb5-48" tabindex="-1"></a>  <span class="co"># Python environment management:</span></span>
<span id="cb5-49"><a href="#cb5-49" tabindex="-1"></a>  <span class="at">conda_env =</span> conda_env,</span>
<span id="cb5-50"><a href="#cb5-50" tabindex="-1"></a>  <span class="at">conda_env_required =</span> <span class="cn">TRUE</span></span>
<span id="cb5-51"><a href="#cb5-51" tabindex="-1"></a>)}</span>
<span id="cb5-52"><a href="#cb5-52" tabindex="-1"></a></span>
<span id="cb5-53"><a href="#cb5-53" tabindex="-1"></a><span class="co"># Inspect results:</span></span>
<span id="cb5-54"><a href="#cb5-54" tabindex="-1"></a>res_adversarial<span class="sc">$</span>PiStar_point<span class="sc">$</span>k1     <span class="co"># The learned factor-level distribution(s)</span></span>
<span id="cb5-55"><a href="#cb5-55" tabindex="-1"></a>res_adversarial<span class="sc">$</span>PiStar_point<span class="sc">$</span>k2     <span class="co"># The learned factor-level distribution(s)</span></span>
<span id="cb5-56"><a href="#cb5-56" tabindex="-1"></a>res_adversarial<span class="sc">$</span>Q_point_mEst     <span class="co"># The estimated performance or outcome</span></span>
<span id="cb5-57"><a href="#cb5-57" tabindex="-1"></a></span>
<span id="cb5-58"><a href="#cb5-58" tabindex="-1"></a>res_adversarial<span class="sc">$</span>PiStar_se<span class="sc">$</span>k1        <span class="co"># Standard errors (if compute_se=TRUE)</span></span>
<span id="cb5-59"><a href="#cb5-59" tabindex="-1"></a>res_adversarial<span class="sc">$</span>PiStar_se<span class="sc">$</span>k2        <span class="co"># Standard errors (if compute_se=TRUE)</span></span>
<span id="cb5-60"><a href="#cb5-60" tabindex="-1"></a>res_adversarial<span class="sc">$</span>Q_se_mEst        <span class="co"># Standard errors (if compute_se=TRUE)</span></span></code></pre></div>
<p>Each side’s factor-level probabilities can be inspected. For
instance, <code>k1</code> might heavily upweight
<code>Experience=&quot;High&quot;</code> if that strongly helps side A, while
<code>k2</code> might prefer <code>Experience=&quot;Low&quot;</code> if that helps
side B. In practice, we might further separate respondents by group
(e.g., one group is relevant for A’s primary, another group for B’s
primary, etc.), though that requires more advanced usage with arguments
like <code>competing_group_variable_respondent</code>.</p>
</div>
<div id="cluster-based-optimiation" class="section level2">
<h2>Cluster-based Optimiation</h2>
<p>TBA</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>res_clust <span class="ot">&lt;-</span> {<span class="fu">cv_strategize</span>(</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="co"># Core inputs:</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="at">Y =</span> Yobs,</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  <span class="at">W =</span> FACTOR_MAT_,</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  <span class="at">X =</span> X,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  <span class="co"># Regularization or penalty inputs:</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  <span class="at">lambda =</span> LAMBDA_SEQ,</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>  <span class="at">penalty_type =</span> regularizationType,</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>  <span class="at">use_regularization =</span> <span class="cn">TRUE</span>,</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>  <span class="co"># Clustering / grouping:</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>  <span class="at">varcov_cluster_variable =</span> cluster_var, <span class="co"># in applications, this could be respondent</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>  <span class="at">competing_group_variable_respondent =</span> <span class="cn">NULL</span>,</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>  <span class="at">competing_group_variable_candidate =</span> <span class="cn">NULL</span>,</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>  <span class="at">competing_group_competition_variable_candidate =</span> <span class="cn">NULL</span>,</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>  <span class="co"># IDs and factor specification:</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>  <span class="at">pair_id =</span> pair_id,</span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>  <span class="at">respondent_id =</span> my_data_red<span class="sc">$</span>respondentIndex,</span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>  <span class="at">respondent_task_id =</span> my_data_red<span class="sc">$</span>task,</span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a>  <span class="at">profile_order =</span> my_data_red<span class="sc">$</span>profile_order,</span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a>  <span class="co"># Probability lists:</span></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a>  <span class="at">p_list =</span> p_list,</span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a>  <span class="at">slate_list =</span> SlateList,</span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a>  <span class="co"># Optimization controls:</span></span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a>  <span class="at">K =</span> <span class="dv">3</span><span class="dt">L</span>,</span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a>  <span class="at">force_gaussian =</span> <span class="cn">FALSE</span>,</span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a>  <span class="at">nSGD =</span> nSGD_TwoStep,</span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a>  <span class="at">nMonte_adversarial =</span> nMonte_adversarial,</span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a>  <span class="at">compute_se =</span> <span class="cn">TRUE</span>,</span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a>  <span class="co"># Cross-validation folds (only used if calling cv_strategize):</span></span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a>  <span class="at">folds =</span> GLOBAL_NFOLDS,</span>
<span id="cb6-37"><a href="#cb6-37" tabindex="-1"></a>  <span class="at">nFolds_glm =</span> nFolds_glm,</span>
<span id="cb6-38"><a href="#cb6-38" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" tabindex="-1"></a>  <span class="co"># Toggling between single-agent vs. adversarial:</span></span>
<span id="cb6-40"><a href="#cb6-40" tabindex="-1"></a>  <span class="at">adversarial =</span> <span class="cn">FALSE</span>,</span>
<span id="cb6-41"><a href="#cb6-41" tabindex="-1"></a></span>
<span id="cb6-42"><a href="#cb6-42" tabindex="-1"></a>  <span class="co"># Python environment management:</span></span>
<span id="cb6-43"><a href="#cb6-43" tabindex="-1"></a>  <span class="at">conda_env =</span> conda_env,</span>
<span id="cb6-44"><a href="#cb6-44" tabindex="-1"></a>  <span class="at">conda_env_required =</span> <span class="cn">TRUE</span></span>
<span id="cb6-45"><a href="#cb6-45" tabindex="-1"></a>)}</span>
<span id="cb6-46"><a href="#cb6-46" tabindex="-1"></a></span>
<span id="cb6-47"><a href="#cb6-47" tabindex="-1"></a><span class="co"># Inspect results:</span></span>
<span id="cb6-48"><a href="#cb6-48" tabindex="-1"></a>res_clust<span class="sc">$</span>PiStar_point     <span class="co"># The learned factor-level distribution(s)</span></span>
<span id="cb6-49"><a href="#cb6-49" tabindex="-1"></a>res_clust<span class="sc">$</span>Q_point_mEst     <span class="co"># The estimated performance or outcome</span></span>
<span id="cb6-50"><a href="#cb6-50" tabindex="-1"></a></span>
<span id="cb6-51"><a href="#cb6-51" tabindex="-1"></a>res_clust<span class="sc">$</span>PiStar_se        <span class="co"># Standard errors (if compute_se=TRUE)</span></span>
<span id="cb6-52"><a href="#cb6-52" tabindex="-1"></a>res_clust<span class="sc">$</span>Q_se_mEst  </span></code></pre></div>
</div>
</div>
<div id="advanced-topics" class="section level1">
<h1>Advanced Topics</h1>
<p>Additional advanced functionalities include:</p>
<ul>
<li><code>use_regularization = TRUE</code> if you want <em>both</em> the
distribution itself <em>and</em> the outcome model to be regularized
(especially for many factors).</li>
<li><code>slate_list</code> to restrict certain factors (like if you
have a known set of feasible factor-level combos in a candidate
primary).</li>
<li>Cluster-based expansions for multi-cluster designs, specifying
<code>K &gt; 1</code> for a mixture approach.</li>
</ul>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>This vignette has illustrated the core usage of the
<code>strategize</code> package for:</p>
<ol style="list-style-type: decimal">
<li>Defining factor-level assignment probabilities (the original
design).</li>
<li>Fitting an outcome model or passing your own model estimates.</li>
<li>Optimizing to find an <em>average-case</em> or <em>adversarial</em>
(max-min) solution for a new factor-level distribution.</li>
<li>Interpreting the estimated solution, e.g., the new distribution that
up- or down-weights certain levels.</li>
</ol>
<p>We hope this helps you investigate questions of <em>optimal</em> or
<em>adversarial</em> design in conjoint experiments, bridging policy
learning and typical factorial designs. Please see the documentation of
<code>strategize</code>, <code>cv_strategize</code>, and
<code>strategize_onestep</code> for additional arguments and more
advanced use-cases.</p>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<p>Jerzak, Connor T., Priyanshi Chandra, and Rishi Hazra. 2025.
“Selecting Optimal Candidate Profiles in Adversarial Environments Using
Conjoint Analysis and Machine Learning.” <em>arXiv preprint</em>
arXiv:2504.19043. <a href="https://arxiv.org/abs/2504.19043" class="uri">https://arxiv.org/abs/2504.19043</a>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bibtex"><code class="sourceCode bibtex"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="va">@misc</span>{<span class="ot">jerzak2025selectingoptimalcandidateprofiles</span>,</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>      <span class="dt">title</span>={Selecting Optimal Candidate Profiles in Adversarial Environments Using Conjoint Analysis and Machine Learning},</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>      <span class="dt">author</span>={Connor T. Jerzak and Priyanshi Chandra and Rishi Hazra},</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>      <span class="dt">year</span>={2025},</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>      <span class="dt">eprint</span>={2504.19043},</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>      <span class="dt">archivePrefix</span>={arXiv},</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>      <span class="dt">primaryClass</span>={stat.ME},</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>      <span class="dt">url</span>={https://arxiv.org/abs/2504.19043},</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>}</span></code></pre></div>
<!--
 install.packages( "~/Documents/strategize-software/strategize", repos = NULL, type = "source",force = FALSE)
-->
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
